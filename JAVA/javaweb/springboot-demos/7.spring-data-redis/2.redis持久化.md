## RDB持久化

**原理是将Redis在内存中的数据库记录定时dump到磁盘上**

RDB持久化是指在指定的时间间隔内将内存中的数据集快照写入磁盘，实际操作过程是fork一个子进程，先将数据集写入临时文件，写入成功后，再替换之前的文件，用二进制压缩存储。

![Redis持久化的几种方式1](2.redis%E6%8C%81%E4%B9%85%E5%8C%96.assets/22633ef9869b949ae8ccde64cd0e7d141603772651466.png)

**优势**：

- redis数据库将只包含一个文件，非常便于文件的备份。
- 

**劣势：**

- 系统一旦出现在持久化之前出现宕机现象，此前没有来得及写入磁盘的数据将会丢失。
- 通过fork子进程来协助完成数据库持久化工作的，因此，如果当数据及较大时，可能会导致服务器停止几百毫秒。



## AOF(append only file)持久化

**原理是将Redis的操作日志以追加的方式写入文件**

AOF持久化以日志的形式记录服务器所处理的每一个写。删操作，查询操作不会被记录。以文本的方式记录，可以打开文件看到详细的操作记录。

![Redis持久化的几种方式2](2.redis%E6%8C%81%E4%B9%85%E5%8C%96.assets/5020cb7496701e171732b57d42b957011603772651466.png)

**优势：**

redis提供三种同步策略：每秒同步，每修改同步和不同步

每秒同步也是异步完成的，其效率非常高。所差的是一旦系统出现宕机现象，那么这一秒种之内修改的数据将会丢失。

而每修改同步，我们可以将其视为同步持久化，即每次发生的数据变化都会被立即记录到磁盘中。可以预见，这种方式在效率上是最低的。

由于该机制对日志文件的写入操作采用的是append模式，因此在写入过程中即使出现宕机现象，也不会破坏日志文件中已经存在的内容。

1. 由于该机制对日志文件的写入操作采用的是append模式，因此在写入过程中即使出现宕机现象，也不会破坏日志文件中已经存在的内容。然而如果我们本次操作只是写入了一半数据就出现了系统崩溃问题，不用担心，在Redis下一次启动之前，我们可以通过redis-check-aof工具来帮助我们解决数据一致性的问题

**劣势？**

1. 对于相同数量的数据集而言，AOF文件通常要大于RDB文件.RDB在恢复大数据集时速度比AOF的恢复速度快。
2. 根据同步策略的不同，AOF在运行效率上往往会慢于RDB。总之，每秒同步策略的效率是比较高的。同步禁用策略的效率和RDB一样高效。