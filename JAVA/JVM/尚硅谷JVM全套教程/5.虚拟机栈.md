### Java虚拟机栈是什么？

每个线程在创建时都会创建一个虚拟机栈，其内部保存一个个栈帧，对应着一次次的java方法调用。是线程私有的。

### 生命周期

生命周期和线程一致

### 作用

主管Java程序的运行，它保存方法的局部变量、部分结果、并参与方法的调用和返回。

### 栈中存储什么

- 栈中的数据都是以栈帧的格式存在。
- 正在执行的每个方法都各自对应一个栈帧
- 栈帧是一个内存区块，是一个数据集，维系着方法执行过程中的各种数据信息。

### 栈运行原理

- 先进后出
- 在一条活动线程中，一个事件点上，只会有一个活动的栈帧。即当前栈帧（栈顶栈帧）是有效的。
- 不同线程中所包含的栈帧是不允许存在互相引用的，即不可能在一个栈帧中引用另一个线程的栈帧。
- 方法返回之际，当前栈帧会传回此方法的执行结果给前一个栈帧。
- Java方法有两种返回函数的方式，一种是return，一种是抛出异常。

![image-20210830132030026](5.%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88.assets/image-20210830132030026.png)

## 栈帧的内部结构

每个栈帧中存储着：

1. **局部变量表**
2. **操作数栈（表达式栈）**
3. 动态连接（指向运行时常量池的方法引用）
4. 方法返回地址
5. 一些附加信息

![image-20210830133159080](5.%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88.assets/image-20210830133159080.png)

### 局部变量表

- 定义为一个数字数组，主要用于存储方法参数和定义在方法体内的局部变量，这些数据包括各种基本数据类型、引用类型、以及返回地址。
- 线程私有，不存在数据安全问题。
- 局部变量表所需要的容量的大小是在编译期间确定下来的。方法运行期间不会改变局部变量表的大小。
- 方法嵌套调用的次数由栈的大小决定。
- 局部变量表中的变量只在当前方法调用中有效。 当方法调用结束后，随着方法栈帧的销毁，局部变量表也会随之销毁。（皮之不存，毛将焉附）

最基本的存储单元是slot变量槽，可以存放编译期可知的各种基本数据类型（8种：六种数字类型：四种整型：byte、short、int、long、两种浮点型：float、double。一种类型boolean。一种字符类型：char）引用类型等。

在局部变量表里面32位以内的类型只占用一个slot

![image-20210916110321307](5.%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88.assets/image-20210916110321307.png)