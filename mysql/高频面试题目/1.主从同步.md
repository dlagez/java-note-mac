https://www.bilibili.com/video/BV1hv411K7Ey?p=66&spm_id_from=pageDriver



mysql为什么需要主从同步？

1. 在业务复杂的系统中，有一句sql需要锁表，导致暂时不能使用读服务，使用主从复制，让主库负责写，从库负责读，这样，即使主库出现了锁表的情景，通过读取从库也可以保证业务的正常运作。
2. 做数据的热备份，准备一个不参与服务的数据库，在主数据库挂掉了，使用这个准备的数据库应急。
3. 业务量大，I/O访问频率过高，单机无法满足。每两百万的数据放在一个数据库里面，五个数据库可以存放1000万的数据。（分库分表）



复制原理：

-   从库会生成两个线程，一个IO线程，一个sql线程
- I/O线程会去请求主库的binlog，并将得到的binlog写到本地的relay-log（中继日志）文件中。
- 主库会生成一个log dump线程，用来给从库I/O线程传binlog
- sql线程，会读取relay-log文件中的日志，并解析成sql语句逐一执行。

注意的点：

1. master将操作语句记录到binlog日志中，然后授予slave远程链接的权限（master一定要开启binlog二进制日志功能，通常为了数据安全考虑，slave也开启binlog功能）
2. slave开启两个线程，IO线程和sql线程，其中IO线程负责读取master的binlog内容到中继日志relay log里，sql线程负责读取relay-log内容，并更新到数据库里面，保证salve数据库数据和master数据库的数据一致。
3. 最好保证主从数据库的版本一致，最少要保证从数据库库的版本高于主数据库。 
4. master和slave量节点时间需要同步。

![image-20210824142408710](1.%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5.assets/image-20210824142408710.png)

复制过程：

![image-20210824142419864](1.%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5.assets/image-20210824142419864.png)