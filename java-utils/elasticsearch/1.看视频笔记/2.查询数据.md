### 搜索（查询，是难点）

传入参数，根据名字查询

```
GET pms/_doc/_search
{
  "query": {
    "match": {
      "brandName": "海澜之家"
    }
  },
}
```

在结果中我们可以看见：hits字段

- 包含索引和文档信息
- 查询的结果总数：total
- 查询出来的具体的文档

```json
{
  "took" : 2,
  "timed_out" : false,
  "_shards" : {
    "total" : 1,
    "successful" : 1,
    "skipped" : 0,
    "failed" : 0
  },
  "hits" : {
    "total" : {
      "value" : 3,
      "relation" : "eq"
    },
    "max_score" : 1.2321435,
    "hits" : [
      {
        "_index" : "pms",
        "_type" : "_doc",
        "_id" : "30",
        "_score" : 1.2321435,
        "_source" : {
          "_class" : "com.roczhang.mall.nosql.elasticsearch.document.EsProduct",
          "id" : 30,
          "productSn" : "HNTBJ2E042A",
          "brandId" : 50,
          "brandName" : "海澜之家",
          "productCategoryId" : 8,
          "productCategoryName" : "T恤",
          "pic" : "http://macro-oss.oss-cn-shenzhen.aliyuncs.com/mall/images/20180615/5ad83a4fN6ff67ecd.jpg!cc_350x449.jpg",
          "name" : "HLA海澜之家简约动物印花短袖T恤",
          "subTitle" : "2018夏季新品微弹舒适新款短T男生 6月6日-6月20日，满300减30，参与互动赢百元礼券，立即分享赢大奖",
          "Keywords" : "",
          "price" : 98.0,
          "sale" : 0,
          "newStatus" : 1,
          "recommandStatus" : 1,
          "stock" : 100,
          "promotionType" : 0,
          "sort" : 0,
          "attrValueList" : [
            {
              "id" : 202,
              "productAttributeId" : 39,
              "value" : "短袖",
              "type" : 1,
              "name" : "袖长"
            },
            {
              "id" : 201,
              "productAttributeId" : 38,
              "value" : "2018年夏",
              "type" : 1,
              "name" : "上市时间"
            },
            {
              "id" : 200,
              "productAttributeId" : 37,
              "value" : "青年",
              "type" : 1,
              "name" : "适用人群"
            },
            {
              "id" : 199,
              "productAttributeId" : 25,
              "value" : "夏季",
              "type" : 1,
              "name" : "适用季节"
            },
            {
              "id" : 198,
              "productAttributeId" : 24,
              "type" : 1,
              "name" : "商品编号"
            }
          ]
        }
    ]
  }
}
```

### 结果的过滤

如果我们要查询的数据库字段比较多，而我们只需要其中两类字段，可以指定_sources属性。

```json
GET pms/_doc/_search
{
  "query": {
    "match": {
      "brandName": "海澜之家"
    }
  },
  "_source": ["id", "brandName", "name", "subTitle"]
}
```

结果：

```json
{
  "took" : 3,
  "timed_out" : false,
  "_shards" : {
    "total" : 1,
    "successful" : 1,
    "skipped" : 0,
    "failed" : 0
  },
  "hits" : {
    "total" : {
      "value" : 3,
      "relation" : "eq"
    },
    "max_score" : 1.2321435,
    "hits" : [
      {
        "_index" : "pms",
        "_type" : "_doc",
        "_id" : "30",
        "_score" : 1.2321435,
        "_source" : {
          "brandName" : "海澜之家",
          "subTitle" : "2018夏季新品微弹舒适新款短T男生 6月6日-6月20日，满300减30，参与互动赢百元礼券，立即分享赢大奖",
          "name" : "HLA海澜之家简约动物印花短袖T恤",
          "id" : 30
        }
      },
      {
        "_index" : "pms",
        "_type" : "_doc",
        "_id" : "31",
        "_score" : 1.2321435,
        "_source" : {
          "brandName" : "海澜之家",
          "subTitle" : "2018夏季新品短袖T恤男HNTBJ2E080A 蓝灰花纹80 175/92A/L80A 蓝灰花纹80 175/92A/L",
          "name" : "HLA海澜之家蓝灰花纹圆领针织布短袖T恤",
          "id" : 31
        }
      },
      {
        "_index" : "pms",
        "_type" : "_doc",
        "_id" : "32",
        "_score" : 1.2321435,
        "_source" : {
          "brandName" : "海澜之家",
          "subTitle" : "HLA海澜之家短袖T恤男基础款简约圆领HNTBJ2E153A藏青(F3)175/92A(50)",
          "name" : "HLA海澜之家短袖T恤男基础款",
          "id" : 32
        }
      }
    ]
  }
}
```

### 结果的排序：

指定sort字段进行排序。

```json
"sort": [
    {
      "id": {
        "order": "asc"
      }
    }
    ]
```



```json
GET pms/_doc/_search
{
  "query": {
    "match": {
      "brandName": "海澜之家"
    }
  },
  "_source": ["id", "brandName", "name", "subTitle"],
  "sort": [
    {
      "id": {
        "order": "asc"
      }
    }
    ]
}
```



```json
{
  "took" : 3,
  "timed_out" : false,
  "_shards" : {
    "total" : 1,
    "successful" : 1,
    "skipped" : 0,
    "failed" : 0
  },
  "hits" : {
    "total" : {
      "value" : 3,
      "relation" : "eq"
    },
    "max_score" : null,
    "hits" : [
      {
        "_index" : "pms",
        "_type" : "_doc",
        "_id" : "30",
        "_score" : null,
        "_source" : {
          "brandName" : "海澜之家",
          "subTitle" : "2018夏季新品微弹舒适新款短T男生 6月6日-6月20日，满300减30，参与互动赢百元礼券，立即分享赢大奖",
          "name" : "HLA海澜之家简约动物印花短袖T恤",
          "id" : 30
        },
        "sort" : [
          30
        ]
      },
      {
        "_index" : "pms",
        "_type" : "_doc",
        "_id" : "31",
        "_score" : null,
        "_source" : {
          "brandName" : "海澜之家",
          "subTitle" : "2018夏季新品短袖T恤男HNTBJ2E080A 蓝灰花纹80 175/92A/L80A 蓝灰花纹80 175/92A/L",
          "name" : "HLA海澜之家蓝灰花纹圆领针织布短袖T恤",
          "id" : 31
        },
        "sort" : [
          31
        ]
      },
      {
        "_index" : "pms",
        "_type" : "_doc",
        "_id" : "32",
        "_score" : null,
        "_source" : {
          "brandName" : "海澜之家",
          "subTitle" : "HLA海澜之家短袖T恤男基础款简约圆领HNTBJ2E153A藏青(F3)175/92A(50)",
          "name" : "HLA海澜之家短袖T恤男基础款",
          "id" : 32
        },
        "sort" : [
          32
        ]
      }
    ]
  }
}

```

### 分页查询：

指定两个字段即可，开始的索引和数据的数量。

  "from": 0,
  "size": 1

```json
GET pms/_doc/_search
{
  "query": {
    "match": {
      "brandName": "海澜之家"
    }
  },
  "_source": ["id", "brandName", "name", "subTitle"],
  "sort": [
    {
      "id": {
        "order": "asc"
      }
    }
  ],
  "from": 0,
  "size": 1
}
```

```json
{
  "took" : 21,
  "timed_out" : false,
  "_shards" : {
    "total" : 1,
    "successful" : 1,
    "skipped" : 0,
    "failed" : 0
  },
  "hits" : {
    "total" : {
      "value" : 3,
      "relation" : "eq"
    },
    "max_score" : null,
    "hits" : [
      {
        "_index" : "pms",
        "_type" : "_doc",
        "_id" : "30",
        "_score" : null,
        "_source" : {
          "brandName" : "海澜之家",
          "subTitle" : "2018夏季新品微弹舒适新款短T男生 6月6日-6月20日，满300减30，参与互动赢百元礼券，立即分享赢大奖",
          "name" : "HLA海澜之家简约动物印花短袖T恤",
          "id" : 30
        },
        "sort" : [
          30
        ]
      }
    ]
  }
}
```

### boolean的多条件查询

must和mysql的and一样。

should和mysql的or一样。

must_not是和not一样。

```
GET pms/_doc/_search
{
  "query": {
    "bool": {
      "must":[
      {
        "match": {
          "name": "海澜"
        }
      }, 
      {
        "match": {
          "recommandStatus": 0
        }  
      }
      ]
    }
  }
}
```

```json
{
  "took" : 18,
  "timed_out" : false,
  "_shards" : {
    "total" : 1,
    "successful" : 1,
    "skipped" : 0,
    "failed" : 0
  },
  "hits" : {
    "total" : {
      "value" : 2,
      "relation" : "eq"
    },
    "max_score" : 3.842372,
    "hits" : [
      {
        "_index" : "pms",
        "_type" : "_doc",
        "_id" : "32",
        "_score" : 3.842372,
        "_source" : {
          "_class" : "com.roczhang.mall.nosql.elasticsearch.document.EsProduct",
          "id" : 32,
          "productSn" : "HNTBJ2E153A",
          "brandId" : 50,
          "brandName" : "海澜之家",
          "productCategoryId" : 8,
          "productCategoryName" : "T恤",
          "pic" : "http://macro-oss.oss-cn-shenzhen.aliyuncs.com/mall/images/20180615/5a51eb88Na4797877.jpg",
          "name" : "HLA海澜之家短袖T恤男基础款",
          "subTitle" : "HLA海澜之家短袖T恤男基础款简约圆领HNTBJ2E153A藏青(F3)175/92A(50)",
          "Keywords" : "",
          "price" : 68.0,
          "sale" : 0,
          "newStatus" : 0,
          "recommandStatus" : 0,
          "stock" : 100,
          "promotionType" : 0,
          "sort" : 0,
          "attrValueList" : [ ]
        }
      },
      {
        "_index" : "pms",
        "_type" : "_doc",
        "_id" : "31",
        "_score" : 3.5212364,
        "_source" : {
          "_class" : "com.roczhang.mall.nosql.elasticsearch.document.EsProduct",
          "id" : 31,
          "productSn" : "HNTBJ2E080A",
          "brandId" : 50,
          "brandName" : "海澜之家",
          "productCategoryId" : 8,
          "productCategoryName" : "T恤",
          "pic" : "http://macro-oss.oss-cn-shenzhen.aliyuncs.com/mall/images/20180615/5ac98b64N70acd82f.jpg!cc_350x449.jpg",
          "name" : "HLA海澜之家蓝灰花纹圆领针织布短袖T恤",
          "subTitle" : "2018夏季新品短袖T恤男HNTBJ2E080A 蓝灰花纹80 175/92A/L80A 蓝灰花纹80 175/92A/L",
          "Keywords" : "",
          "price" : 98.0,
          "sale" : 0,
          "newStatus" : 0,
          "recommandStatus" : 0,
          "stock" : 100,
          "promotionType" : 0,
          "sort" : 0,
          "attrValueList" : [
            {
              "id" : 187,
              "productAttributeId" : 39,
              "value" : "短袖",
              "type" : 1,
              "name" : "袖长"
            },
            {
              "id" : 186,
              "productAttributeId" : 38,
              "value" : "2018年夏",
              "type" : 1,
              "name" : "上市时间"
            },
            {
              "id" : 185,
              "productAttributeId" : 37,
              "value" : "青年",
              "type" : 1,
              "name" : "适用人群"
            },
            {
              "id" : 184,
              "productAttributeId" : 25,
              "value" : "夏季",
              "type" : 1,
              "name" : "适用季节"
            },
            {
              "id" : 183,
              "productAttributeId" : 24,
              "type" : 1,
              "name" : "商品编号"
            }
          ]
        }
      }
    ]
  }
}
```

### 过滤器：

指定过滤器，gt是大于，lt是小于。gte大于等于，lte小于等于。

```json
GET pms/_doc/_search
{
  "query": {
    "bool": {
      "must":[
      {
        "match": {
          "name": "海澜"
        }
      }
      ],
      "filter": {
        "range": {
          "price": {
            "gt": 50
          }
        }
      }
    }
  }
}
```

条件可以联合：

```json
GET pms/_doc/_search
{
  "query": {
    "bool": {
      "must":[
      {
        "match": {
          "name": "海澜"
        }
      }
      ],
      "filter": {
        "range": {
          "price": {
            "gt": 1,
            "lt": 10
          }
        }
      }
    }
  }
}
```

### 匹配多个条件

条件之间使用空格隔开即可。

```
GET pms/_doc/_search
{
  "query": {
    "match": {
      "brandName": "海澜之家 衣服"
    }
  },
}
```

