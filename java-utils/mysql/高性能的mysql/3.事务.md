## 事务

事务就是一组原子性的sql查询。

事务内的语句，要么全部执行成功，要么全部执行失败。

## ACID

### 原子性：

一个事务必须被视为一个不可分割的最小工作单元，整个事务中的所有操作，要么全部提交成功，要么全部回滚失败。

### 一致性：

数据库总是从一个一致性的状态转移到另外一个一致性的状态。

### 隔离性：

一个事务所做的修改在最终提交之前，对其他事务是不可见的。

### 持久性：

一旦事务提交，则其所做的修改就会永久保存到数据库中。

## 隔离级别：

在sql标准中定义了四种隔离级别，每一种级别都规定了一个事务中所作的修改。级别较低的隔离通常可以执行更高的并发。

#### READ UNCOMMITTED（未提交读）

事务中做的修改，即使没有提交，对其他事务也都是可见的。事务可以读取未提交的数据，这被称为脏读。很少应用。

#### READ COMMITTED（提交读）

一个事务从开始直到提交之前，所做的任何修改对其他事务都是不可见的。

也叫不可重复读。

#### REPEATABLE READ（可重复读）

REPEATABLE READ解决了脏读的问题，保证了在同一事务中多次读取同样记录的结果是一致的。

幻读：当某个事务在读取某个范围内的记录时，另外一个事务又在该范围内插入了新的记录，当之前的事务再次读取该范围的记录时，会产生幻行。

#### SERIALIZABLE（可串行化）

会在读取的每一行数据上都加锁。很少会用到该级别。

![image-20210823113315824](3.%E4%BA%8B%E5%8A%A1.assets/image-20210823113315824.png)

## 死锁

两个或者多个事务在同一资源上相互占用，并请求锁定对方占用的资源，从而导致恶性循环的现象。

解决：只有部分或者完全回滚其中的一个事务，才能打破死锁。